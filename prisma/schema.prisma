// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model BeagleProgram {
  id                        String   @id @default(cuid())
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  // Property manager details
  propertyManagerName       String
  propertyManagerSlug       String   @unique // used in URL, e.g. "santa-fe-property-management"

  // Insurance verification link (required)
  insuranceVerificationUrl  String

  // Optional embedded webview URL
  // If provided, displays as iframe on the public program page
  webviewUrl                String?  // e.g., "https://tools.yourrenterskit.com/renter-benefits/8omnj4cltuawsbsfzz"

  // Program configuration - admin selects which products to offer
  // selectedProducts: array of product objects with prices like [{ id: "product_100k", name: "...", price: "$15/month" }]
  selectedProducts          Json     @default("[]") // array of selected products with prices

  // Publication status
  isPublished               Boolean  @default(false)

  // Optional form for opt-out functionality
  form                      Form?

  @@index([propertyManagerSlug])
  @@index([isPublished])
}

model Form {
  id                                  String   @id @default(cuid())
  createdAt                           DateTime @default(now())
  updatedAt                           DateTime @updatedAt

  beagleProgramId                     String   @unique
  beagleProgram                       BeagleProgram @relation(fields: [beagleProgramId], references: [id], onDelete: Cascade)

  // Opt-out configuration - admin checks these boxes
  tenantLiabilityWaiverCanOptOut      Boolean  @default(false)
  rentersKitCanOptOut                 Boolean  @default(false)

  // Responses from tenants
  responses                           OptOutResponse[]

  @@index([beagleProgramId])
}

model OptOutResponse {
  id                                  String   @id @default(cuid())
  createdAt                           DateTime @default(now())

  formId                              String
  form                                Form     @relation(fields: [formId], references: [id], onDelete: Cascade)

  firstName                           String
  lastName                            String

  // Track which products they opted out of
  optedOutOfTenantLiabilityWaiver     Boolean  @default(false)
  optedOutOfRentersKit                Boolean  @default(false)

  @@index([formId])
}

